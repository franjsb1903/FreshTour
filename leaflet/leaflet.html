<!DOCTYPE html>
<html>

<head>

    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
    <script src="./script.js"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #myMap {
            height: 100%;
            width: 100%;
        }

        .leaflet-locate {
            background-image: url(../images/compass.png);
        }
    </style>


</head>

<body>



    <div id="myMap"></div>
    <script>

        const tilesProvider = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'

        const myMap = L.map('myMap').fitWorld();

        var tile = L.tileLayer(tilesProvider, {
            maxZoom: 18,
            tileSize: 512,
            zoomOffset: -1
        }).addTo(myMap);

        myMap.fitBounds([
            [42.928129720484264, -8.596746459275112],
            [42.93265446394879, -8.465597167120524],
            [42.843606832802664, -8.469888701549666],
            [42.84562062833106, -8.612024321842858]
        ]);

        var geojson = undefined;

        //var data = '{"type":"FeatureCollection","bbox":[8.676404,49.411796,8.691914,49.423112],"features":[{"type":"Feature","properties":{"group_index":0,"value":200.0,"center":[8.681495737068015,49.41461001633336]},"geometry":{"coordinates":[[[8.677704,49.414499],[8.677708,49.414139],[8.679158,49.41269],[8.682219,49.412252],[8.684703,49.413755],[8.684942,49.414773],[8.684914,49.415132],[8.681861,49.417257],[8.681857,49.417258],[8.680192,49.416583],[8.678809,49.415576],[8.677772,49.414637],[8.677704,49.414499]]],"type":"Polygon"}},{"type":"Feature","properties":{"group_index":0,"value":300.0,"center":[8.681495737068015,49.41461001633336]},"geometry":{"coordinates":[[[8.676404,49.414844],[8.676501,49.413666],[8.677238,49.412373],[8.677682,49.412038],[8.678407,49.411925],[8.680359,49.411832],[8.68152,49.411796],[8.684658,49.412332],[8.686349,49.413631],[8.686706,49.413899],[8.68675,49.413971],[8.686716,49.414329],[8.686063,49.415391],[8.685652,49.415893],[8.68333,49.417558],[8.681551,49.418453],[8.681465,49.418439],[8.680037,49.417712],[8.679719,49.417544],[8.67788,49.416371],[8.677007,49.415559],[8.676404,49.414844]]],"type":"Polygon"}},{"type":"Feature","properties":{"group_index":1,"value":200.0,"center":[8.68650646264858,49.41942995674008]},"geometry":{"coordinates":[[[8.682915,49.419263],[8.683047,49.418734],[8.685213,49.417614],[8.687287,49.417372],[8.687646,49.417398],[8.688886,49.418293],[8.690329,49.419838],[8.690277,49.419925],[8.69027,49.419936],[8.690211,49.420021],[8.689023,49.420622],[8.687634,49.421308],[8.686113,49.421879],[8.685847,49.421941],[8.685534,49.421764],[8.682915,49.419263]]],"type":"Polygon"}},{"type":"Feature","properties":{"group_index":1,"value":300.0,"center":[8.68650646264858,49.41942995674008]},"geometry":{"coordinates":[[[8.681715,49.418481],[8.681774,49.418126],[8.685465,49.416381],[8.687507,49.416113],[8.687861,49.416175],[8.689349,49.417218],[8.691002,49.418659],[8.691914,49.41972],[8.691828,49.419896],[8.691223,49.420663],[8.689781,49.421546],[8.688009,49.422234],[8.686604,49.422794],[8.685092,49.423112],[8.684799,49.422904],[8.682538,49.420533],[8.681715,49.418481]]],"type":"Polygon"}}],"metadata":{"attribution":"openrouteservice.org | OpenStreetMap contributors","service":"isochrones","timestamp":1618229289060,"query":{"locations":[[8.681495,49.41461],[8.686507,49.41943]],"range":[300.0,200.0]},"engine":{"version":"6.4.1","build_date":"2021-04-12T07:11:51Z","graph_date":"2021-04-08T14:17:53Z"}}}'

        console.log(data);

        addLayer(data);

        function addLayer(data) {
            if (geojson != undefined) {
                myMap.removeLayer(geojson);
                geojson = undefined;
            }
            geojson = L.geoJson(data, {
                onEachFeature: function (feature, layer) {
                    console.log(feature);
                    layer.bindPopup('<p>' + feature.properties.titulo + '</p>');
                    layer.on('click', function (e) {
                        myMap.setView(e.latlng, 16);
                    });
                }
            }).addTo(myMap);

        }

        function diHola() {
            console.log("hola");
        }

        var options = {
            position: 'topright', // toolbar position, options are 'topleft', 'topright', 'bottomleft', 'bottomright'
            drawMarker: false, // adds button to draw markers
            drawPolyline: false, // adds button to draw a polyline
            drawRectangle: false, // adds button to draw a rectangle
            drawPolygon: false, // adds button to draw a polygon
            drawCircle: false, // adds button to draw a cricle
            cutPolygon: false, // adds button to cut a hole in a polygon
            editMode: false, // adds button to toggle edit mode for all layers
            removalMode: false, // adds a button to remove layers
            drawCircleMarker: false,
            dragMode: false
        };

        // add leaflet.pm controls to the map
        myMap.pm.addControls(options);

        myMap.pm.setLang('es');

        var customControl = {
            name: "Locate",
            block: "custom",
            title: "Localizar posicion actual",
            onClick: function () {
                window.ReactNativeWebView.postMessage("Hello!")
            },
            toggle: false,
            className: "leaflet-locate"
        }

        myMap.pm.Toolbar.createCustomControl(customControl);

        addMarker(42.928129720484264, -8.596746459275112);

        function addMarker(lat, lang) {
            var greenIcon = L.icon({
                iconUrl: 'leaf-green.png',
                shadowUrl: 'leaf-shadow.png',

                iconSize: [38, 95], // size of the icon
                shadowSize: [50, 64], // size of the shadow
                iconAnchor: [22, 94], // point of the icon which will correspond to marker's location
                shadowAnchor: [4, 62],  // the same for the shadow
                popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
            });
            L.marker([lat, lang], { icon: greenIcon }).addTo(myMap);
            myMap.setView([lat, lang], 16);
        }

    </script>

</body>

</html>